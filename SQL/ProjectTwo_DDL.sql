--SQL DDL for Project Two
--lookup table for users, 1-employee, 2-manager
DROP TABLE SU_ROLES;
/
CREATE TABLE SU_ROLES(
 SUR_id INT,
 SUR_name VARCHAR2(4000) UNIQUE,
 PRIMARY KEY(SUR_id)
);
/
DROP TABLE SCRUM_USERS;
/
CREATE TABLE SCRUM_USERS(
 user_id INT,
 user_fn VARCHAR2(4000),
 user_ln VARCHAR2(4000),
 user_username VARCHAR2(4000) UNIQUE NOT NULL,
 user_password VARCHAR2(4000) NOT NULL,
 SUR_id INT DEFAULT 0 NOT NULL,
 user_email VARCHAR2(4000),
 PRIMARY KEY(user_id),
 FOREIGN KEY(SUR_id) REFERENCES SU_ROLES(SUR_id)
);
/
DROP TABLE SCRUM_BOARDS;
/
CREATE TABLE SCRUM_BOARDS(
 SB_ID INT,
 USER_ID INT NOT NULL,
 SB_NAME VARCHAR2(4000) UNIQUE NOT NULL,
 SB_length INT DEFAULT 14 NOT NULL, --for length of sprint
 SB_START TIMESTAMP DEFAULT CURRENT_TIMESTAMP, --for start date of sprint
 PRIMARY KEY(SB_ID),
 FOREIGN KEY(USER_ID) REFERENCES SCRUM_USERS(USER_ID)
);
/
--Join table? users and boards is a many-to-many relationship
DROP TABLE USERS_BOARDS;
/
CREATE TABLE USERS_BOARDS(
USER_ID INT,
SB_ID INT,
PRIMARY KEY(USER_ID,SB_ID),
FOREIGN KEY (USER_ID) REFERENCES SCRUM_USERS(USER_ID),
FOREIGN KEY (SB_ID) REFERENCES SCRUM_BOARDS(SB_ID)
);
/
--lookup table for stories? 1-backlog, 2-TODO, 3-In Progress, 4-Test, 5-Verify, 6-Done (Tentative)
DROP TABLE SB_LANES;
/
CREATE TABLE SB_LANES(
 SBL_ID INT,
 SBL_NAME VARCHAR2(4000) UNIQUE,
 PRIMARY KEY(SBL_ID)
);
/
DROP TABLE SB_STORIES;
/
CREATE TABLE SB_STORIES(
 SBS_ID INT,
 SB_ID INT NOT NULL,
 SBS_description VARCHAR2(4000),
 SBS_POINTS INT NOT NULL,
 SBL_id INT NOT NULL,
 SBS_DONE TIMESTAMP,
 PRIMARY KEY(SBS_id),
 FOREIGN KEY(SB_id) REFERENCES SCRUM_BOARDS(SB_id),
 FOREIGN KEY(SBL_ID) REFERENCES SB_LANES(SBL_ID)
);
/
--for status, 0-incomplete, 1-complete
DROP TABLE SB_TASKS;
/
CREATE TABLE SB_TASKS(
 SBT_ID INT,
 SBS_ID INT NOT NULL,
 SBT_STATUS INT DEFAULT 0 NOT NULL,
 SBT_description VARCHAR2(4000),
 PRIMARY KEY(SBT_id),
 FOREIGN KEY(SBS_id) REFERENCES SB_STORIES(SBS_id)
);
/
--sequences for the tables that will need them
CREATE SEQUENCE SU_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SB_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SBS_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SBT_SEQ START WITH 1 INCREMENT BY 1;
/
--triggers for the sequences
CREATE OR REPLACE TRIGGER SU_SEQ_TRIGGER
BEFORE INSERT ON SCRUM_USERS
FOR EACH ROW
BEGIN
IF :NEW.USER_ID IS NULL THEN
SELECT SU_SEQ.NEXTVAL INTO :NEW.USER_ID FROM DUAL;
END IF;
END;
/
CREATE OR REPLACE TRIGGER SB_SEQ_TRIGGER
BEFORE INSERT ON SCRUM_BOARDS
FOR EACH ROW
BEGIN
IF :NEW.SB_ID IS NULL THEN
SELECT SB_SEQ.NEXTVAL INTO :NEW.SB_ID FROM DUAL;
END IF;
END;
/
CREATE OR REPLACE TRIGGER SBS_SEQ_TRIGGER
BEFORE INSERT ON SB_STORIES
FOR EACH ROW
BEGIN
IF :NEW.SBS_ID IS NULL THEN
SELECT SBS_SEQ.NEXTVAL INTO :NEW.SBS_ID FROM DUAL;
END IF;
END;
/
CREATE OR REPLACE TRIGGER SBT_SEQ_TRIGGER
BEFORE INSERT ON SB_TASKS
FOR EACH ROW
BEGIN
IF :NEW.SBT_ID IS NULL THEN
SELECT SBT_SEQ.NEXTVAL INTO :NEW.SBT_ID FROM DUAL;
END IF;
END;
/
COMMIT;
/